<html>
    <body>

    </body>
    <script type='module'>
        import { XzReadableStream } from './lib/xzwasm.js';

        (async function load() {
            const wasmBytes = await (await fetch('lib/xzwasm.wasm')).arrayBuffer();
            const wasmResponse = new Response(wasmBytes, { headers: { "Content-Type": "application/wasm" } });
            const module = await WebAssembly.instantiateStreaming(wasmResponse, {});

            for (var i = 0; i < 3; i++) {
                const helloResponse = await fetch('data/hello.txt.xz');
                const decompressedStream = new XzReadableStream(module.instance, helloResponse.body);
                const decompressedResponse = new Response(decompressedStream, { headers: { "Content-Type": "text/html" } });
                const allText = await decompressedResponse.text();
                console.log(allText);
            }
        })();
    </script>
</html>
